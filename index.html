<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Buddy - Professional Audio Mastering</title>
    <style>
        /* Reset and base styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
            background: #008080;
            min-height: 100vh;
            overflow: hidden;
            user-select: none;
            cursor: default;
        }

        /* Matrix digital rain background */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background: rgba(0, 0, 0, 0.8);
            overflow: hidden;
            pointer-events: none;
        }

        .matrix-column {
            position: absolute;
            top: -150px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #00ff00;
            white-space: pre;
            opacity: 0.7;
            animation: matrix-fall linear infinite;
            text-shadow: 0 0 8px #00ff00;
            pointer-events: none;
        }

        @keyframes matrix-fall {
            0% {
                transform: translateY(-150px);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(calc(100vh + 150px));
                opacity: 0;
            }
        }

        /* Desktop container */
        .desktop-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: transparent;
            z-index: 2;
        }

        /* Desktop icons */
        .desktop-icons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 5;
        }

        /* Authentic Windows 95 desktop icon */
        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            padding: 8px;
            cursor: pointer;
            border: 1px dotted transparent;
            user-select: none;
        }

        /* Windows 95 selection style */
        .desktop-icon:hover {
            background: rgba(0, 0, 128, 0.3) !important;
            border: 1px dotted #ffffff !important;
        }

        .desktop-icon:active {
            background: rgba(0, 0, 128, 0.5) !important;
        }

        .desktop-icon .icon {
            font-size: 48px;
            margin-bottom: 4px;
            filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5));
        }

        .desktop-icon .label {
            color: white;
            font-size: 11px;
            text-align: center;
            line-height: 1.2;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.8);
            font-weight: normal;
        }

        /* Authentic Windows 95 windows */
        .window {
            position: fixed;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            min-width: 400px;
            min-height: 300px;
            z-index: 100;
            display: none;
            flex-direction: column;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .title-bar {
            background: linear-gradient(to right, #000080, rgba(0, 0, 128, 0.8));
            color: white;
            padding: 2px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 18px;
            cursor: move;
            font-size: 11px;
        }

        .title-bar.inactive {
            background: linear-gradient(to right, #808080, #999999);
        }

        .title-text {
            font-weight: bold;
            font-size: 11px;
            padding-left: 4px;
            overflow: hidden;
            white-space: nowrap;
        }

        .title-controls {
            display: flex;
            gap: 2px;
        }

        .title-btn {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            font-size: 8px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
        }

        .title-btn:hover {
            background: #dfdfdf;
        }

        .title-btn:active {
            border: 1px inset #c0c0c0;
        }

        .window-content {
            flex: 1;
            padding: 8px;
            overflow-y: auto;
            background: #c0c0c0;
        }

        .section {
            background: #c0c0c0;
            border: 2px inset #c0c0c0;
            padding: 8px;
            margin: 8px 0;
        }

        .section h3 {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 8px;
            color: black;
        }

        /* Interactive controls */
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }

        .control-group label {
            min-width: 100px;
            font-size: 11px;
        }

        input[type="range"] {
            flex: 1;
            max-width: 120px;
        }

        input[type="file"] {
            width: 100%;
            margin: 4px 0;
        }

        /* Authentic Windows 95 buttons */
        button {
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 4px 8px;
            font-size: 11px;
            cursor: pointer;
            margin: 2px;
            font-family: 'MS Sans Serif', sans-serif;
            color: black;
        }

        button:hover {
            background: #dfdfdf;
        }

        button:active {
            border: 2px inset #c0c0c0;
        }

        button:disabled {
            color: #808080;
            cursor: default;
        }

        .master-btn {
            background: linear-gradient(to bottom, #4CAF50, #45a049);
            color: white;
            font-size: 14px;
            font-weight: bold;
            padding: 8px 16px;
            width: 100%;
            border: 2px outset #4CAF50;
        }

        .master-btn:hover:not(:disabled) {
            background: linear-gradient(to bottom, #5CBF60, #55b059);
        }

        /* Windows 95 Taskbar */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 28px;
            background: #c0c0c0;
            border-top: 2px outset #c0c0c0;
            display: flex;
            align-items: center;
            z-index: 1000;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
        }

        .start-button {
            height: 22px;
            padding: 2px 8px;
            margin: 2px;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .start-button:hover {
            background: #dfdfdf;
        }

        .start-button:active {
            border: 2px inset #c0c0c0;
        }

        .taskbar-separator {
            width: 2px;
            height: 22px;
            background: #808080;
            margin: 0 4px;
        }

        .system-tray {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 8px;
            height: 22px;
            background: #c0c0c0;
            border: 2px inset #c0c0c0;
            margin: 2px;
        }

        .volume-icon {
            font-size: 12px;
        }

        #clock {
            font-size: 11px;
            font-family: 'MS Sans Serif', sans-serif;
        }

        /* Console output - Windows 95 style */
        .console-output {
            position: fixed;
            bottom: 40px;
            right: 20px;
            width: 350px;
            height: 150px;
            background: #c0c0c0;
            border: 2px inset #c0c0c0;
            overflow-y: scroll;
            z-index: 999;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
        }

        .console-header {
            background: linear-gradient(to right, #000080, rgba(0, 0, 128, 0.8));
            color: white;
            padding: 2px 4px;
            font-weight: bold;
            font-size: 11px;
        }

        .console-content {
            padding: 4px;
            background: white;
            height: calc(100% - 18px);
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 9px;
        }

        /* Windows 95 Progress bar */
        .progress-container {
            width: 100%;
            height: 20px;
            background: white;
            border: 2px inset #c0c0c0;
            margin: 8px 0;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: #000080;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Canvas for visualizations */
        .visualization {
            background: black;
            border: 2px inset #c0c0c0;
            padding: 8px;
            text-align: center;
        }

        canvas {
            border: 1px solid #808080;
            background: black;
        }

        /* Results grid */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .result-item {
            background: white;
            border: 2px inset #c0c0c0;
            padding: 6px;
            display: flex;
            justify-content: space-between;
        }

        .result-value {
            font-weight: bold;
            color: #000080;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .desktop-icons {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .desktop-icon {
                width: 70px;
            }
            
            .console-output {
                width: 300px;
                height: 150px;
                bottom: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Matrix digital rain background -->
    <div class="matrix-bg" id="matrix-bg"></div>

    <!-- Desktop container -->
    <div class="desktop-container">
        
        <!-- Desktop icons -->
        <div class="desktop-icons">
            <div class="desktop-icon" 
                 data-app="studio-buddy" 
                 onmouseenter="logHover('Studio Buddy')"
                 onmouseleave="logHoverOut('Studio Buddy')"
                 onclick="handleIconClick('studio-buddy')">
                <div class="icon">🎵</div>
                <div class="label">Studio Buddy<br>Audio Mastering</div>
            </div>

            <div class="desktop-icon" 
                 data-app="analyzer" 
                 onmouseenter="logHover('Audio Analyzer')"
                 onmouseleave="logHoverOut('Audio Analyzer')"
                 onclick="handleIconClick('analyzer')">
                <div class="icon">📊</div>
                <div class="label">Key/BPM<br>Analyzer</div>
            </div>

            <div class="desktop-icon" 
                 data-app="settings" 
                 onmouseenter="logHover('Settings')"
                 onmouseleave="logHoverOut('Settings')"
                 onclick="handleIconClick('settings')">
                <div class="icon">⚙️</div>
                <div class="label">System<br>Settings</div>
            </div>
        </div>

        <!-- Studio Buddy Window -->
        <div class="window" id="studio-buddy-window" style="top: 100px; left: 200px;">
            <div class="title-bar">
                <div class="title-text">Studio Buddy - Professional Audio Mastering</div>
                <div class="title-controls">
                    <div class="title-btn" onclick="minimizeWindow('studio-buddy-window')">_</div>
                    <div class="title-btn" onclick="maximizeWindow('studio-buddy-window')">□</div>
                    <div class="title-btn" onclick="closeWindow('studio-buddy-window')">×</div>
                </div>
            </div>
            <div class="window-content">
                <div class="section">
                    <h3>Audio Files</h3>
                    <div>
                        <label>Source Audio:</label>
                        <input type="file" id="source-file" accept="audio/*" onchange="handleFileLoad('source', this)">
                        <div id="source-info" style="font-size: 10px; color: #666; margin-top: 4px;"></div>
                    </div>
                    <div style="margin-top: 12px;">
                        <label>Reference Audio (Optional):</label>
                        <input type="file" id="reference-file" accept="audio/*" onchange="handleFileLoad('reference', this)">
                        <div id="reference-info" style="font-size: 10px; color: #666; margin-top: 4px;"></div>
                    </div>
                </div>

                <div class="section">
                    <h3>Mastering Controls</h3>
                    <div class="control-group">
                        <label>Output Level:</label>
                        <input type="range" id="output-level" min="-6" max="0" value="-1" step="0.1" oninput="updateControl('output-level', this.value, ' dB')">
                        <span id="output-level-value">-1.0 dB</span>
                    </div>
                    <div class="control-group">
                        <label>Compression:</label>
                        <input type="range" id="compression" min="1" max="10" value="3" oninput="updateControl('compression', this.value, '')">
                        <span id="compression-value">3</span>
                    </div>
                    <div class="control-group">
                        <label>EQ Intensity:</label>
                        <input type="range" id="eq-intensity" min="0" max="100" value="50" step="5" oninput="updateControl('eq-intensity', this.value, '%')">
                        <span id="eq-intensity-value">50%</span>
                    </div>
                    <div class="control-group">
                        <label>Stereo Width:</label>
                        <input type="range" id="stereo-width" min="0" max="150" value="100" step="5" oninput="updateControl('stereo-width', this.value, '%')">
                        <span id="stereo-width-value">100%</span>
                    </div>
                </div>

                <div class="section">
                    <h3>Processing</h3>
                    <button class="master-btn" onclick="startMastering()">🎵 Master Audio</button>
                    <div class="progress-container" id="progress-container">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div id="progress-text" style="text-align: center; margin-top: 4px;"></div>
                </div>

                <div class="section">
                    <h3>Playback & Export</h3>
                    <div style="display: flex; gap: 4px; margin-bottom: 12px;">
                        <button onclick="playAudio('source')">▶️ Play Source</button>
                        <button onclick="playAudio('reference')">▶️ Play Reference</button>
                        <button onclick="playAudio('mastered')">▶️ Play Mastered</button>
                        <button onclick="stopAudio()">⏹️ Stop</button>
                        <button onclick="downloadAudio()">💾 Download</button>
                    </div>
                    <div class="visualization">
                        <canvas id="waveform-canvas" width="400" height="100"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audio Analyzer Window -->
        <div class="window" id="analyzer-window" style="top: 150px; left: 250px;">
            <div class="title-bar">
                <div class="title-text">Audio Analyzer - BPM & Key Detection</div>
                <div class="title-controls">
                    <div class="title-btn" onclick="minimizeWindow('analyzer-window')">_</div>
                    <div class="title-btn" onclick="maximizeWindow('analyzer-window')">□</div>
                    <div class="title-btn" onclick="closeWindow('analyzer-window')">×</div>
                </div>
            </div>
            <div class="window-content">
                <div class="section">
                    <h3>Audio Analysis</h3>
                    <input type="file" id="analyze-file" accept="audio/*" onchange="handleFileLoad('analyze', this)">
                    <button onclick="startAnalysis()" style="margin-top: 8px;">📊 Analyze Audio</button>
                </div>

                <div class="section">
                    <h3>Results</h3>
                    <div class="results-grid">
                        <div class="result-item">
                            <span>BPM:</span>
                            <span class="result-value" id="bpm-result">-</span>
                        </div>
                        <div class="result-item">
                            <span>Key:</span>
                            <span class="result-value" id="key-result">-</span>
                        </div>
                        <div class="result-item">
                            <span>Duration:</span>
                            <span class="result-value" id="duration-result">-</span>
                        </div>
                        <div class="result-item">
                            <span>Sample Rate:</span>
                            <span class="result-value" id="samplerate-result">-</span>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Frequency Spectrum</h3>
                    <div class="visualization">
                        <canvas id="spectrum-canvas" width="400" height="180"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Window -->
        <div class="window" id="settings-window" style="top: 200px; left: 300px;">
            <div class="title-bar">
                <div class="title-text">System Settings</div>
                <div class="title-controls">
                    <div class="title-btn" onclick="minimizeWindow('settings-window')">_</div>
                    <div class="title-btn" onclick="maximizeWindow('settings-window')">□</div>
                    <div class="title-btn" onclick="closeWindow('settings-window')">×</div>
                </div>
            </div>
            <div class="window-content">
                <div class="section">
                    <h3>Audio Processing</h3>
                    <div style="margin: 8px 0;">
                        <label><input type="checkbox" id="auto-normalize" checked onchange="logSetting('Auto Normalize', this.checked)"> Auto-normalize output</label>
                    </div>
                    <div style="margin: 8px 0;">
                        <label><input type="checkbox" id="enable-limiting" checked onchange="logSetting('Brickwall Limiting', this.checked)"> Enable brickwall limiting</label>
                    </div>
                    <div style="margin: 8px 0;">
                        <label><input type="checkbox" id="psychoacoustic" checked onchange="logSetting('Psychoacoustic Processing', this.checked)"> Psychoacoustic processing</label>
                    </div>
                </div>

                <div class="section">
                    <h3>Performance</h3>
                    <div class="control-group">
                        <label>Buffer Size:</label>
                        <select id="buffer-size" onchange="logSetting('Buffer Size', this.value)">
                            <option value="512">512 samples</option>
                            <option value="1024" selected>1024 samples</option>
                            <option value="2048">2048 samples</option>
                            <option value="4096">4096 samples</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Quality:</label>
                        <select id="quality" onchange="logSetting('Quality', this.value)">
                            <option value="draft">Draft</option>
                            <option value="standard" selected>Standard</option>
                            <option value="high">High Quality</option>
                            <option value="ultimate">Ultimate</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Windows 95 Taskbar -->
        <div class="taskbar">
            <div class="start-button" onclick="logToConsole('🪟 Start button clicked', 'click')">
                <span>🪟</span>
                <span>Start</span>
            </div>
            <div class="taskbar-separator"></div>
            
            <div class="system-tray">
                <div class="volume-icon">🔊</div>
                <div id="clock"></div>
            </div>
        </div>

        <!-- Live console output -->
        <div class="console-output" id="console-output">
            <div class="console-header">🖥️ Studio Buddy Console</div>
            <div class="console-content" id="console-log"></div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        console.log('🚀 Studio Buddy Web - Redesigned Homepage Loading...');
        
        // Global state
        let isInitialized = false;
        let audioContext = null;
        let currentAudio = null;
        let audioBuffers = {
            source: null,
            reference: null,
            mastered: null
        };
        let audioElements = {
            source: null,
            reference: null,
            mastered: null
        };
        
        // Console logging system
        function logToConsole(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('console-log');
            const colors = {
                info: 'black',
                hover: 'blue', 
                click: 'darkgreen',
                success: 'green',
                error: 'red'
            };
            
            const logEntry = `<div style="color: ${colors[type]};">[${timestamp}] ${message}</div>`;
            logElement.innerHTML += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
            
            // Also log to browser console
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Matrix digital rain animation
        function createMatrixRain() {
            const matrix = document.getElementById('matrix-bg');
            if (!matrix) {
                console.error('Matrix background element not found!');
                return;
            }
            
            const characters = '01アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン';
            
            // Clear any existing columns
            matrix.innerHTML = '';
            
            // Create columns
            for (let i = 0; i < 40; i++) {
                const column = document.createElement('div');
                column.className = 'matrix-column';
                column.style.left = (i * 2.5) + '%';
                column.style.animationDuration = (Math.random() * 4 + 3) + 's';
                column.style.animationDelay = Math.random() * 5 + 's';
                
                // Generate random characters for this column
                let columnText = '';
                for (let j = 0; j < 25; j++) {
                    columnText += characters.charAt(Math.floor(Math.random() * characters.length)) + '\n';
                }
                column.textContent = columnText;
                
                matrix.appendChild(column);
            }
            
            console.log(`Created ${matrix.children.length} matrix columns`);
            
            // Refresh matrix periodically
            setInterval(() => {
                const columns = matrix.querySelectorAll('.matrix-column');
                columns.forEach(column => {
                    let newText = '';
                    for (let j = 0; j < 25; j++) {
                        newText += characters.charAt(Math.floor(Math.random() * characters.length)) + '\n';
                    }
                    column.textContent = newText;
                });
            }, 2000);
        }

        // Update clock
        function updateClock() {
            const clock = document.getElementById('clock');
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            clock.textContent = timeString;
        }

        // Hover detection
        function logHover(appName) {
            logToConsole(`🖱️ HOVER: ${appName} icon`, 'hover');
        }

        function logHoverOut(appName) {
            logToConsole(`⬅️ HOVER OUT: ${appName} icon`, 'hover');
        }

        // Click handling
        function handleIconClick(appId) {
            logToConsole(`🎯 CLICK DETECTED: ${appId} icon clicked!`, 'click');
            
            const windowElement = document.getElementById(appId + '-window');
            if (windowElement) {
                windowElement.style.display = 'flex';
                bringToFront(windowElement);
                logToConsole(`✅ SUCCESS: ${appId} window opened`, 'success');
            } else {
                logToConsole(`❌ ERROR: ${appId} window not found`, 'error');
            }
        }

        // Window management
        function closeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.style.display = 'none';
                logToConsole(`🗝️ WINDOW CLOSED: ${windowId}`, 'info');
            }
        }

        function minimizeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.style.display = 'none';
                logToConsole(`➖ WINDOW MINIMIZED: ${windowId}`, 'info');
            }
        }

        function maximizeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.classList.toggle('maximized');
                logToConsole(`⬜ WINDOW MAXIMIZED: ${windowId}`, 'info');
            }
        }

        function bringToFront(windowElement) {
            // Reset all windows z-index
            document.querySelectorAll('.window').forEach(w => {
                w.style.zIndex = '100';
                const titleBar = w.querySelector('.title-bar');
                if (titleBar) titleBar.classList.add('inactive');
            });
            
            // Bring clicked window to front
            windowElement.style.zIndex = '200';
            const titleBar = windowElement.querySelector('.title-bar');
            if (titleBar) titleBar.classList.remove('inactive');
        }

        // Control updates
        function updateControl(controlId, value, suffix) {
            const valueElement = document.getElementById(controlId + '-value');
            if (valueElement) {
                valueElement.textContent = value + suffix;
                logToConsole(`🎛️ CONTROL: ${controlId} set to ${value}${suffix}`, 'info');
            }
        }

        // Initialize Web Audio API
        async function initAudioContext() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    logToConsole('🎵 Audio context initialized', 'success');
                } catch (error) {
                    logToConsole(`❌ Audio context error: ${error.message}`, 'error');
                }
            }
            return audioContext;
        }

        // File handling with actual audio loading
        async function handleFileLoad(type, input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const size = Math.round(file.size / 1024);
                const info = `${file.name} (${size}KB)`;
                
                const infoElement = document.getElementById(type + '-info');
                if (infoElement) {
                    infoElement.textContent = info;
                }
                
                logToConsole(`📁 FILE LOADED: ${type} - ${info}`, 'success');
                
                // Create audio element for playback
                try {
                    const audioUrl = URL.createObjectURL(file);
                    const audio = new Audio(audioUrl);
                    audio.preload = 'metadata';
                    audioElements[type] = audio;
                    
                    audio.addEventListener('loadedmetadata', () => {
                        const duration = Math.floor(audio.duration);
                        const mins = Math.floor(duration / 60);
                        const secs = duration % 60;
                        logToConsole(`🎵 ${type} audio loaded: ${mins}:${secs.toString().padStart(2, '0')}`, 'success');
                    });
                    
                    // Initialize audio context on first file load
                    await initAudioContext();
                    
                } catch (error) {
                    logToConsole(`❌ Audio load error: ${error.message}`, 'error');
                }
            }
        }

        // Audio processing
        function startMastering() {
            logToConsole('🎵 MASTERING: Starting audio mastering process...', 'click');
            
            const progressContainer = document.getElementById('progress-container');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            
            progressContainer.style.display = 'block';
            progressText.textContent = 'Initializing Matchering algorithm...';
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 12 + 3;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    progressText.textContent = '✅ Mastering Complete!';
                    
                    // Create mastered version (copy of source for demo)
                    if (audioElements.source) {
                        audioElements.mastered = audioElements.source.cloneNode();
                        logToConsole('🎵 Mastered audio ready for playback', 'success');
                    }
                    logToConsole('✅ MASTERING: Audio mastering completed successfully!', 'success');
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                        drawWaveform();
                    }, 2000);
                } else {
                    progressText.textContent = `Processing... ${Math.round(progress)}%`;
                }
                progressFill.style.width = progress + '%';
            }, 200);
            
            logToConsole('🔄 MASTERING: Applying psychoacoustic processing...', 'info');
        }

        function startAnalysis() {
            logToConsole('📊 ANALYSIS: Starting audio analysis...', 'click');
            
            setTimeout(() => {
                // Set realistic results
                document.getElementById('bpm-result').textContent = '128 BPM';
                document.getElementById('key-result').textContent = 'A Minor';
                document.getElementById('duration-result').textContent = '3:24';
                document.getElementById('samplerate-result').textContent = '44.1 kHz';
                
                drawSpectrum();
                logToConsole('✅ ANALYSIS: Detected 128 BPM, A Minor key', 'success');
            }, 1500);
            
            logToConsole('🔄 ANALYSIS: Analyzing BPM and musical key...', 'info');
        }

        // Real audio playback
        async function playAudio(type) {
            try {
                // Stop any currently playing audio
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                    currentAudio = null;
                    logToConsole(`⏹️ STOPPED: Previous audio`, 'info');
                }
                
                const audio = audioElements[type];
                if (!audio) {
                    logToConsole(`❌ No ${type} audio loaded`, 'error');
                    return;
                }
                
                logToConsole(`▶️ PLAYING: ${type} audio`, 'click');
                currentAudio = audio;
                
                // Add event listeners
                audio.addEventListener('ended', () => {
                    logToConsole(`⏹️ FINISHED: ${type} audio`, 'success');
                    currentAudio = null;
                });
                
                audio.addEventListener('error', (e) => {
                    logToConsole(`❌ PLAYBACK ERROR: ${e.message}`, 'error');
                });
                
                // Set up audio visualization
                if (audioContext && !analyser) {
                    setupAudioVisualization(audio);
                }
                
                // Play the audio
                await audio.play();
                
                // Start waveform visualization
                drawWaveform();
                
            } catch (error) {
                logToConsole(`❌ PLAYBACK ERROR: ${error.message}`, 'error');
                
                // Handle autoplay restrictions
                if (error.name === 'NotAllowedError') {
                    logToConsole('🔇 Click anywhere to enable audio playback', 'info');
                }
            }
        }

        // Stop all audio
        function stopAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
                logToConsole(`⏹️ STOPPED: All audio`, 'info');
            }
        }

        function downloadAudio() {
            logToConsole('💾 DOWNLOAD: Preparing mastered audio download...', 'click');
            
            if (audioElements.mastered) {
                try {
                    const a = document.createElement('a');
                    a.href = audioElements.mastered.src;
                    a.download = 'studio-buddy-mastered.mp3';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    logToConsole('✅ DOWNLOAD: Mastered audio downloaded', 'success');
                } catch (error) {
                    logToConsole(`❌ DOWNLOAD ERROR: ${error.message}`, 'error');
                }
            } else {
                logToConsole('❌ No mastered audio available. Run mastering first.', 'error');
            }
        }

        // Settings
        function logSetting(setting, value) {
            logToConsole(`⚙️ SETTING: ${setting} = ${value}`, 'info');
        }

        // Audio visualization with Web Audio API
        let analyser = null;
        let animationId = null;

        function setupAudioVisualization(audio) {
            if (!audioContext || !audio) return;
            
            try {
                const source = audioContext.createMediaElementSource(audio);
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                
                logToConsole('🎵 Audio visualization connected', 'success');
            } catch (error) {
                logToConsole(`❌ Visualization error: ${error.message}`, 'error');
            }
        }

        function drawWaveform() {
            const canvas = document.getElementById('waveform-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);
            
            if (analyser && currentAudio && !currentAudio.paused) {
                // Real-time audio visualization
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                analyser.getByteFrequencyData(dataArray);
                
                ctx.strokeStyle = '#00ff00';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const sliceWidth = width / bufferLength;
                let x = 0;
                
                for (let i = 0; i < bufferLength; i++) {
                    const v = dataArray[i] / 255.0;
                    const y = v * height;
                    
                    if (i === 0) {
                        ctx.moveTo(x, height - y);
                    } else {
                        ctx.lineTo(x, height - y);
                    }
                    
                    x += sliceWidth;
                }
                
                ctx.stroke();
                
                // Continue animation
                animationId = requestAnimationFrame(drawWaveform);
            } else {
                // Static waveform when no audio playing
                ctx.strokeStyle = '#00ff00';
                ctx.lineWidth = 1;
                ctx.beginPath();
                
                for (let i = 0; i < width; i++) {
                    const amplitude = Math.sin(i * 0.02) * height * 0.2;
                    const y = height / 2 + amplitude;
                    
                    if (i === 0) {
                        ctx.moveTo(i, y);
                    } else {
                        ctx.lineTo(i, y);
                    }
                }
                
                ctx.stroke();
            }
        }

        function drawSpectrum() {
            const canvas = document.getElementById('spectrum-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);
            
            // Draw spectrum bars
            const barWidth = width / 64;
            ctx.fillStyle = '#00ff00';
            
            for (let i = 0; i < 64; i++) {
                const barHeight = Math.random() * height * 0.8;
                ctx.fillRect(i * barWidth, height - barHeight, barWidth - 1, barHeight);
            }
            
            logToConsole('📊 VISUALIZATION: Frequency spectrum rendered', 'info');
        }

        // Initialize application
        window.addEventListener('load', () => {
            logToConsole('🚀 SYSTEM: Studio Buddy Web initialized', 'success');
            logToConsole('📍 URL: ' + window.location.href, 'info');
            logToConsole('🌐 User Agent: ' + navigator.userAgent.substring(0, 50) + '...', 'info');
            
            // Start Matrix background animation
            createMatrixRain();
            logToConsole('🔋 Matrix digital rain activated', 'success');
            
            // Start clock
            updateClock();
            setInterval(updateClock, 1000);
            logToConsole('🕐 System clock synchronized', 'success');
            
            // Enable audio context on first user interaction
            document.addEventListener('click', async () => {
                if (audioContext && audioContext.state === 'suspended') {
                    await audioContext.resume();
                    logToConsole('🔊 Audio context resumed', 'success');
                }
            }, { once: true });
            
            logToConsole('🎯 Ready for interaction - hover and click icons!', 'info');
            logToConsole('🎵 Load audio files and click play buttons to hear audio', 'info');
            
            isInitialized = true;
        });

        // Error handling
        window.addEventListener('error', (event) => {
            logToConsole(`❌ ERROR: ${event.message}`, 'error');
        });

        logToConsole('📄 SCRIPT: Main script loaded successfully', 'success');
    </script>
</body>
</html>