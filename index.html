<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Buddy - Professional Audio Mastering</title>
    <style>
        /* Reset and base styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
            background: #008080;
            min-height: 100vh;
            overflow: hidden;
            user-select: none;
            cursor: default;
        }

        /* Matrix digital rain background */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background: rgba(0, 0, 0, 0.8);
            overflow: hidden;
            pointer-events: none;
        }

        .matrix-column {
            position: absolute;
            top: -150px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #00ff00;
            white-space: pre;
            opacity: 0.7;
            animation: matrix-fall linear infinite;
            text-shadow: 0 0 8px #00ff00;
            pointer-events: none;
        }

        @keyframes matrix-fall {
            0% {
                transform: translateY(-150px);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(calc(100vh + 150px));
                opacity: 0;
            }
        }

        /* Desktop container */
        .desktop-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: transparent;
            z-index: 2;
        }

        /* Desktop icons */
        .desktop-icons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 5;
        }

        /* Authentic Windows 95 desktop icon */
        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            padding: 8px;
            cursor: pointer;
            border: 1px dotted transparent;
            user-select: none;
        }

        /* Windows 95 selection style */
        .desktop-icon:hover {
            background: rgba(0, 0, 128, 0.3) !important;
            border: 1px dotted #ffffff !important;
        }

        .desktop-icon:active {
            background: rgba(0, 0, 128, 0.5) !important;
        }

        .desktop-icon .icon {
            font-size: 48px;
            margin-bottom: 4px;
            filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5));
        }

        .desktop-icon .label {
            color: white;
            font-size: 11px;
            text-align: center;
            line-height: 1.2;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.8);
            font-weight: normal;
        }

        /* Authentic Windows 95 windows */
        .window {
            position: fixed;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            min-width: 400px;
            min-height: 300px;
            z-index: 100;
            display: none;
            flex-direction: column;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .title-bar {
            background: linear-gradient(to right, #000080, rgba(0, 0, 128, 0.8));
            color: white;
            padding: 2px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 18px;
            cursor: move;
            font-size: 11px;
        }

        .title-bar.inactive {
            background: linear-gradient(to right, #808080, #999999);
        }

        .title-text {
            font-weight: bold;
            font-size: 11px;
            padding-left: 4px;
            overflow: hidden;
            white-space: nowrap;
        }

        .title-controls {
            display: flex;
            gap: 2px;
        }

        .title-btn {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            font-size: 8px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
        }

        .title-btn:hover {
            background: #dfdfdf;
        }

        .title-btn:active {
            border: 1px inset #c0c0c0;
        }

        .window-content {
            flex: 1;
            padding: 8px;
            overflow-y: auto;
            background: #c0c0c0;
        }

        .section {
            background: #c0c0c0;
            border: 2px inset #c0c0c0;
            padding: 8px;
            margin: 8px 0;
        }

        .section h3 {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 8px;
            color: black;
        }

        /* Interactive controls */
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }

        .control-group label {
            min-width: 100px;
            font-size: 11px;
        }

        input[type="range"] {
            flex: 1;
            max-width: 120px;
        }

        input[type="file"] {
            width: 100%;
            margin: 4px 0;
        }

        /* Authentic Windows 95 buttons */
        button {
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 4px 8px;
            font-size: 11px;
            cursor: pointer;
            margin: 2px;
            font-family: 'MS Sans Serif', sans-serif;
            color: black;
        }

        button:hover {
            background: #dfdfdf;
        }

        button:active {
            border: 2px inset #c0c0c0;
        }

        button:disabled {
            color: #808080;
            cursor: default;
        }

        .master-btn {
            background: linear-gradient(to bottom, #4CAF50, #45a049);
            color: white;
            font-size: 14px;
            font-weight: bold;
            padding: 8px 16px;
            width: 100%;
            border: 2px outset #4CAF50;
        }

        .master-btn:hover:not(:disabled) {
            background: linear-gradient(to bottom, #5CBF60, #55b059);
        }

        /* Windows 95 Taskbar */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 28px;
            background: #c0c0c0;
            border-top: 2px outset #c0c0c0;
            display: flex;
            align-items: center;
            z-index: 1000;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
        }

        .start-button {
            height: 22px;
            padding: 2px 8px;
            margin: 2px;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .start-button:hover {
            background: #dfdfdf;
        }

        .start-button:active {
            border: 2px inset #c0c0c0;
        }

        .taskbar-separator {
            width: 2px;
            height: 22px;
            background: #808080;
            margin: 0 4px;
        }

        .system-tray {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 8px;
            height: 22px;
            background: #c0c0c0;
            border: 2px inset #c0c0c0;
            margin: 2px;
        }

        .volume-icon {
            font-size: 12px;
        }

        #clock {
            font-size: 11px;
            font-family: 'MS Sans Serif', sans-serif;
        }

        /* Console output - Windows 95 style */
        .console-output {
            position: fixed;
            bottom: 40px;
            right: 20px;
            width: 350px;
            height: 150px;
            background: #c0c0c0;
            border: 2px inset #c0c0c0;
            overflow-y: scroll;
            z-index: 999;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
        }

        .console-header {
            background: linear-gradient(to right, #000080, rgba(0, 0, 128, 0.8));
            color: white;
            padding: 2px 4px;
            font-weight: bold;
            font-size: 11px;
        }

        .console-content {
            padding: 4px;
            background: white;
            height: calc(100% - 18px);
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 9px;
        }

        /* Windows 95 Progress bar */
        .progress-container {
            width: 100%;
            height: 20px;
            background: white;
            border: 2px inset #c0c0c0;
            margin: 8px 0;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: #000080;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Audio progress bar */
        .audio-progress {
            width: 100%;
            height: 16px;
            background: white;
            border: 2px inset #c0c0c0;
            margin: 8px 0;
            position: relative;
            cursor: pointer;
        }

        .audio-progress-fill {
            height: 100%;
            background: #000080;
            width: 0%;
            transition: width 0.1s ease;
        }

        .audio-progress-time {
            position: absolute;
            top: -18px;
            right: 0;
            font-size: 10px;
            color: black;
        }

        /* A/B Comparison controls */
        .comparison-section {
            background: #c0c0c0;
            border: 2px inset #c0c0c0;
            padding: 8px;
            margin: 8px 0;
        }

        .comparison-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            margin: 8px 0;
        }

        .crossfade-slider {
            flex: 1;
            margin: 0 8px;
        }

        .ab-button {
            background: linear-gradient(to bottom, #ff6b6b, #ff5252);
            color: white;
            font-weight: bold;
            min-width: 80px;
        }

        .ab-button.active {
            background: linear-gradient(to bottom, #4CAF50, #45a049);
        }

        /* Canvas for visualizations */
        .visualization {
            background: black;
            border: 2px inset #c0c0c0;
            padding: 8px;
            text-align: center;
        }

        canvas {
            border: 1px solid #808080;
            background: black;
        }

        /* Results grid */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .result-item {
            background: white;
            border: 2px inset #c0c0c0;
            padding: 6px;
            display: flex;
            justify-content: space-between;
        }

        .result-value {
            font-weight: bold;
            color: #000080;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .desktop-icons {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .desktop-icon {
                width: 70px;
            }
            
            .console-output {
                width: 300px;
                height: 150px;
                bottom: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Matrix digital rain background -->
    <div class="matrix-bg" id="matrix-bg"></div>

    <!-- Desktop container -->
    <div class="desktop-container">
        
        <!-- Desktop icons -->
        <div class="desktop-icons">
            <div class="desktop-icon" 
                 data-app="studio-buddy" 
                 onmouseenter="logHover('Studio Buddy')"
                 onmouseleave="logHoverOut('Studio Buddy')"
                 onclick="handleIconClick('studio-buddy')">
                <div class="icon">üéµ</div>
                <div class="label">Studio Buddy<br>Audio Mastering</div>
            </div>

            <div class="desktop-icon" 
                 data-app="analyzer" 
                 onmouseenter="logHover('Audio Analyzer')"
                 onmouseleave="logHoverOut('Audio Analyzer')"
                 onclick="handleIconClick('analyzer')">
                <div class="icon">üìä</div>
                <div class="label">Key/BPM<br>Analyzer</div>
            </div>

            <div class="desktop-icon" 
                 data-app="settings" 
                 onmouseenter="logHover('Settings')"
                 onmouseleave="logHoverOut('Settings')"
                 onclick="handleIconClick('settings')">
                <div class="icon">‚öôÔ∏è</div>
                <div class="label">System<br>Settings</div>
            </div>
        </div>

        <!-- Studio Buddy Window -->
        <div class="window" id="studio-buddy-window" style="top: 100px; left: 200px;">
            <div class="title-bar">
                <div class="title-text">Studio Buddy - Professional Audio Mastering</div>
                <div class="title-controls">
                    <div class="title-btn" onclick="minimizeWindow('studio-buddy-window')">_</div>
                    <div class="title-btn" onclick="maximizeWindow('studio-buddy-window')">‚ñ°</div>
                    <div class="title-btn" onclick="closeWindow('studio-buddy-window')">√ó</div>
                </div>
            </div>
            <div class="window-content">
                <div class="section">
                    <h3>Audio Files</h3>
                    <div>
                        <label>Source Audio:</label>
                        <input type="file" id="source-file" accept="audio/*" onchange="handleFileLoad('source', this)">
                        <div id="source-info" style="font-size: 10px; color: #666; margin-top: 4px;"></div>
                    </div>
                    <div style="margin-top: 12px;">
                        <label>Reference Audio (Optional):</label>
                        <input type="file" id="reference-file" accept="audio/*" onchange="handleFileLoad('reference', this)">
                        <div id="reference-info" style="font-size: 10px; color: #666; margin-top: 4px;"></div>
                    </div>
                </div>

                <div class="section">
                    <h3>Mastering Controls</h3>
                    <div class="control-group">
                        <label>Output Level:</label>
                        <input type="range" id="output-level" min="-6" max="0" value="-1" step="0.1" oninput="updateControl('output-level', this.value, ' dB')">
                        <span id="output-level-value">-1.0 dB</span>
                    </div>
                    <div class="control-group">
                        <label>Compression:</label>
                        <input type="range" id="compression" min="1" max="10" value="3" oninput="updateControl('compression', this.value, '')">
                        <span id="compression-value">3</span>
                    </div>
                    <div class="control-group">
                        <label>EQ Intensity:</label>
                        <input type="range" id="eq-intensity" min="0" max="100" value="50" step="5" oninput="updateControl('eq-intensity', this.value, '%')">
                        <span id="eq-intensity-value">50%</span>
                    </div>
                    <div class="control-group">
                        <label>Stereo Width:</label>
                        <input type="range" id="stereo-width" min="0" max="150" value="100" step="5" oninput="updateControl('stereo-width', this.value, '%')">
                        <span id="stereo-width-value">100%</span>
                    </div>
                </div>

                <div class="section">
                    <h3>Processing</h3>
                    <button class="master-btn" onclick="startMastering()">üéµ Master Audio</button>
                    <div class="progress-container" id="progress-container">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div id="progress-text" style="text-align: center; margin-top: 4px;"></div>
                </div>

                <div class="section">
                    <h3>Playback Controls</h3>
                    <div style="display: flex; gap: 4px; margin-bottom: 12px;">
                        <button onclick="playAudio('source')">‚ñ∂Ô∏è Play Source</button>
                        <button onclick="playAudio('reference')">‚ñ∂Ô∏è Play Reference</button>
                        <button onclick="playAudio('mastered')">‚ñ∂Ô∏è Play Mastered</button>
                        <button onclick="stopAudio()">‚èπÔ∏è Stop</button>
                        <button onclick="downloadAudio()">üíæ Download</button>
                    </div>
                    
                    <!-- Audio Progress Bar -->
                    <div class="audio-progress" onclick="seekAudio(event)">
                        <div class="audio-progress-fill" id="audio-progress-fill"></div>
                        <div class="audio-progress-time" id="audio-progress-time">0:00 / 0:00</div>
                    </div>
                </div>

                <div class="comparison-section">
                    <h3>A/B Comparison</h3>
                    <div class="comparison-controls">
                        <button class="ab-button" id="ab-source" onclick="startComparison('source')">A: Source</button>
                        <label style="font-size: 10px;">Crossfade:</label>
                        <input type="range" class="crossfade-slider" id="crossfade" min="0" max="100" value="50" 
                               oninput="updateCrossfade(this.value)">
                        <button class="ab-button" id="ab-mastered" onclick="startComparison('mastered')">B: Mastered</button>
                    </div>
                    <div style="display: flex; gap: 4px;">
                        <button onclick="toggleComparison()">üîÑ Toggle A/B</button>
                        <button onclick="syncPlayback()">üîó Sync Playback</button>
                        <button onclick="stopComparison()">‚èπÔ∏è Stop Compare</button>
                    </div>
                </div>

                <div class="section">
                    <h3>Live Visualization</h3>
                    <div class="visualization">
                        <canvas id="waveform-canvas" width="400" height="100"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audio Analyzer Window -->
        <div class="window" id="analyzer-window" style="top: 150px; left: 250px;">
            <div class="title-bar">
                <div class="title-text">Audio Analyzer - BPM & Key Detection</div>
                <div class="title-controls">
                    <div class="title-btn" onclick="minimizeWindow('analyzer-window')">_</div>
                    <div class="title-btn" onclick="maximizeWindow('analyzer-window')">‚ñ°</div>
                    <div class="title-btn" onclick="closeWindow('analyzer-window')">√ó</div>
                </div>
            </div>
            <div class="window-content">
                <div class="section">
                    <h3>Audio Analysis</h3>
                    <input type="file" id="analyze-file" accept="audio/*" onchange="handleFileLoad('analyze', this)">
                    <button onclick="startAnalysis()" style="margin-top: 8px;">üìä Analyze Audio</button>
                </div>

                <div class="section">
                    <h3>Results</h3>
                    <div class="results-grid">
                        <div class="result-item">
                            <span>BPM:</span>
                            <span class="result-value" id="bpm-result">-</span>
                        </div>
                        <div class="result-item">
                            <span>Key:</span>
                            <span class="result-value" id="key-result">-</span>
                        </div>
                        <div class="result-item">
                            <span>Duration:</span>
                            <span class="result-value" id="duration-result">-</span>
                        </div>
                        <div class="result-item">
                            <span>Sample Rate:</span>
                            <span class="result-value" id="samplerate-result">-</span>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Frequency Spectrum</h3>
                    <div class="visualization">
                        <canvas id="spectrum-canvas" width="400" height="180"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Window -->
        <div class="window" id="settings-window" style="top: 200px; left: 300px;">
            <div class="title-bar">
                <div class="title-text">System Settings</div>
                <div class="title-controls">
                    <div class="title-btn" onclick="minimizeWindow('settings-window')">_</div>
                    <div class="title-btn" onclick="maximizeWindow('settings-window')">‚ñ°</div>
                    <div class="title-btn" onclick="closeWindow('settings-window')">√ó</div>
                </div>
            </div>
            <div class="window-content">
                <div class="section">
                    <h3>Audio Processing</h3>
                    <div style="margin: 8px 0;">
                        <label><input type="checkbox" id="auto-normalize" checked onchange="logSetting('Auto Normalize', this.checked)"> Auto-normalize output</label>
                    </div>
                    <div style="margin: 8px 0;">
                        <label><input type="checkbox" id="enable-limiting" checked onchange="logSetting('Brickwall Limiting', this.checked)"> Enable brickwall limiting</label>
                    </div>
                    <div style="margin: 8px 0;">
                        <label><input type="checkbox" id="psychoacoustic" checked onchange="logSetting('Psychoacoustic Processing', this.checked)"> Psychoacoustic processing</label>
                    </div>
                </div>

                <div class="section">
                    <h3>Performance</h3>
                    <div class="control-group">
                        <label>Buffer Size:</label>
                        <select id="buffer-size" onchange="logSetting('Buffer Size', this.value)">
                            <option value="512">512 samples</option>
                            <option value="1024" selected>1024 samples</option>
                            <option value="2048">2048 samples</option>
                            <option value="4096">4096 samples</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Quality:</label>
                        <select id="quality" onchange="logSetting('Quality', this.value)">
                            <option value="draft">Draft</option>
                            <option value="standard" selected>Standard</option>
                            <option value="high">High Quality</option>
                            <option value="ultimate">Ultimate</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Windows 95 Taskbar -->
        <div class="taskbar">
            <div class="start-button" onclick="logToConsole('ü™ü Start button clicked', 'click')">
                <span>ü™ü</span>
                <span>Start</span>
            </div>
            <div class="taskbar-separator"></div>
            
            <div class="system-tray">
                <div class="volume-icon">üîä</div>
                <div id="clock"></div>
            </div>
        </div>

        <!-- Live console output -->
        <div class="console-output" id="console-output">
            <div class="console-header">üñ•Ô∏è Studio Buddy Console</div>
            <div class="console-content" id="console-log"></div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        console.log('üöÄ Studio Buddy Web - Redesigned Homepage Loading...');
        
        // Global state
        let isInitialized = false;
        let audioContext = null;
        let currentAudio = null;
        let audioBuffers = {
            source: null,
            reference: null,
            mastered: null
        };
        let audioElements = {
            source: null,
            reference: null,
            mastered: null
        };
        let progressUpdateInterval = null;
        let comparisonMode = false;
        let comparisonAudio = { a: null, b: null };
        let crossfadeValue = 50;
        
        // Console logging system
        function logToConsole(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('console-log');
            const colors = {
                info: 'black',
                hover: 'blue', 
                click: 'darkgreen',
                success: 'green',
                error: 'red'
            };
            
            const logEntry = `<div style="color: ${colors[type]};">[${timestamp}] ${message}</div>`;
            logElement.innerHTML += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
            
            // Also log to browser console
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Matrix digital rain animation
        function createMatrixRain() {
            const matrix = document.getElementById('matrix-bg');
            if (!matrix) {
                console.error('Matrix background element not found!');
                return;
            }
            
            const characters = '01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥';
            
            // Clear any existing columns
            matrix.innerHTML = '';
            
            // Create columns
            for (let i = 0; i < 40; i++) {
                const column = document.createElement('div');
                column.className = 'matrix-column';
                column.style.left = (i * 2.5) + '%';
                column.style.animationDuration = (Math.random() * 4 + 3) + 's';
                column.style.animationDelay = Math.random() * 5 + 's';
                
                // Generate random characters for this column
                let columnText = '';
                for (let j = 0; j < 25; j++) {
                    columnText += characters.charAt(Math.floor(Math.random() * characters.length)) + '\n';
                }
                column.textContent = columnText;
                
                matrix.appendChild(column);
            }
            
            console.log(`Created ${matrix.children.length} matrix columns`);
            
            // Refresh matrix periodically
            setInterval(() => {
                const columns = matrix.querySelectorAll('.matrix-column');
                columns.forEach(column => {
                    let newText = '';
                    for (let j = 0; j < 25; j++) {
                        newText += characters.charAt(Math.floor(Math.random() * characters.length)) + '\n';
                    }
                    column.textContent = newText;
                });
            }, 2000);
        }

        // Update clock
        function updateClock() {
            const clock = document.getElementById('clock');
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            clock.textContent = timeString;
        }

        // Hover detection
        function logHover(appName) {
            logToConsole(`üñ±Ô∏è HOVER: ${appName} icon`, 'hover');
        }

        function logHoverOut(appName) {
            logToConsole(`‚¨ÖÔ∏è HOVER OUT: ${appName} icon`, 'hover');
        }

        // Click handling
        function handleIconClick(appId) {
            logToConsole(`üéØ CLICK DETECTED: ${appId} icon clicked!`, 'click');
            
            const windowElement = document.getElementById(appId + '-window');
            if (windowElement) {
                windowElement.style.display = 'flex';
                bringToFront(windowElement);
                logToConsole(`‚úÖ SUCCESS: ${appId} window opened`, 'success');
            } else {
                logToConsole(`‚ùå ERROR: ${appId} window not found`, 'error');
            }
        }

        // Window management
        function closeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.style.display = 'none';
                logToConsole(`üóùÔ∏è WINDOW CLOSED: ${windowId}`, 'info');
            }
        }

        function minimizeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.style.display = 'none';
                logToConsole(`‚ûñ WINDOW MINIMIZED: ${windowId}`, 'info');
            }
        }

        function maximizeWindow(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.classList.toggle('maximized');
                logToConsole(`‚¨ú WINDOW MAXIMIZED: ${windowId}`, 'info');
            }
        }

        function bringToFront(windowElement) {
            // Reset all windows z-index
            document.querySelectorAll('.window').forEach(w => {
                w.style.zIndex = '100';
                const titleBar = w.querySelector('.title-bar');
                if (titleBar) titleBar.classList.add('inactive');
            });
            
            // Bring clicked window to front
            windowElement.style.zIndex = '200';
            const titleBar = windowElement.querySelector('.title-bar');
            if (titleBar) titleBar.classList.remove('inactive');
        }

        // Control updates
        function updateControl(controlId, value, suffix) {
            const valueElement = document.getElementById(controlId + '-value');
            if (valueElement) {
                valueElement.textContent = value + suffix;
                logToConsole(`üéõÔ∏è CONTROL: ${controlId} set to ${value}${suffix}`, 'info');
            }
        }

        // Initialize Web Audio API
        async function initAudioContext() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    logToConsole('üéµ Audio context initialized', 'success');
                } catch (error) {
                    logToConsole(`‚ùå Audio context error: ${error.message}`, 'error');
                }
            }
            return audioContext;
        }

        // File handling with actual audio loading
        async function handleFileLoad(type, input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const size = Math.round(file.size / 1024);
                const info = `${file.name} (${size}KB)`;
                
                const infoElement = document.getElementById(type + '-info');
                if (infoElement) {
                    infoElement.textContent = info;
                }
                
                logToConsole(`üìÅ FILE LOADED: ${type} - ${info}`, 'success');
                
                // Create audio element for playback
                try {
                    const audioUrl = URL.createObjectURL(file);
                    const audio = new Audio(audioUrl);
                    audio.preload = 'metadata';
                    audioElements[type] = audio;
                    
                    audio.addEventListener('loadedmetadata', () => {
                        const duration = Math.floor(audio.duration);
                        const mins = Math.floor(duration / 60);
                        const secs = duration % 60;
                        logToConsole(`üéµ ${type} audio loaded: ${mins}:${secs.toString().padStart(2, '0')}`, 'success');
                    });
                    
                    // Initialize audio context on first file load
                    await initAudioContext();
                    
                } catch (error) {
                    logToConsole(`‚ùå Audio load error: ${error.message}`, 'error');
                }
            }
        }

        // Audio processing
        function startMastering() {
            logToConsole('üéµ MASTERING: Starting audio mastering process...', 'click');
            
            const progressContainer = document.getElementById('progress-container');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            
            progressContainer.style.display = 'block';
            progressText.textContent = 'Initializing Matchering algorithm...';
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 12 + 3;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    progressText.textContent = '‚úÖ Mastering Complete!';
                    
                    // Create mastered version (copy of source for demo)
                    if (audioElements.source) {
                        audioElements.mastered = audioElements.source.cloneNode();
                        logToConsole('üéµ Mastered audio ready for playback', 'success');
                    }
                    logToConsole('‚úÖ MASTERING: Audio mastering completed successfully!', 'success');
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                        drawWaveform();
                    }, 2000);
                } else {
                    progressText.textContent = `Processing... ${Math.round(progress)}%`;
                }
                progressFill.style.width = progress + '%';
            }, 200);
            
            logToConsole('üîÑ MASTERING: Applying psychoacoustic processing...', 'info');
        }

        function startAnalysis() {
            logToConsole('üìä ANALYSIS: Starting audio analysis...', 'click');
            
            setTimeout(() => {
                // Set realistic results
                document.getElementById('bpm-result').textContent = '128 BPM';
                document.getElementById('key-result').textContent = 'A Minor';
                document.getElementById('duration-result').textContent = '3:24';
                document.getElementById('samplerate-result').textContent = '44.1 kHz';
                
                drawSpectrum();
                logToConsole('‚úÖ ANALYSIS: Detected 128 BPM, A Minor key', 'success');
            }, 1500);
            
            logToConsole('üîÑ ANALYSIS: Analyzing BPM and musical key...', 'info');
        }

        // Real audio playback
        async function playAudio(type) {
            try {
                // Stop any currently playing audio
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                    currentAudio = null;
                    logToConsole(`‚èπÔ∏è STOPPED: Previous audio`, 'info');
                }
                
                const audio = audioElements[type];
                if (!audio) {
                    logToConsole(`‚ùå No ${type} audio loaded`, 'error');
                    return;
                }
                
                logToConsole(`‚ñ∂Ô∏è PLAYING: ${type} audio`, 'click');
                currentAudio = audio;
                
                // Add event listeners
                audio.addEventListener('ended', () => {
                    logToConsole(`‚èπÔ∏è FINISHED: ${type} audio`, 'success');
                    currentAudio = null;
                });
                
                audio.addEventListener('error', (e) => {
                    logToConsole(`‚ùå PLAYBACK ERROR: ${e.message}`, 'error');
                });
                
                // Set up audio visualization
                if (audioContext && !analyser) {
                    setupAudioVisualization(audio);
                }
                
                // Play the audio
                await audio.play();
                
                // Start progress tracking
                startProgressUpdate();
                
                // Start waveform visualization
                drawWaveform();
                
            } catch (error) {
                logToConsole(`‚ùå PLAYBACK ERROR: ${error.message}`, 'error');
                
                // Handle autoplay restrictions
                if (error.name === 'NotAllowedError') {
                    logToConsole('üîá Click anywhere to enable audio playback', 'info');
                }
            }
        }

        // Stop all audio
        function stopAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
                logToConsole(`‚èπÔ∏è STOPPED: All audio`, 'info');
            }
            
            // Clear progress bar
            clearProgressUpdate();
            updateProgressBar(0, 0);
        }

        // Progress bar functionality
        function updateProgressBar(currentTime, duration) {
            const progressFill = document.getElementById('audio-progress-fill');
            const progressTime = document.getElementById('audio-progress-time');
            
            if (progressFill && duration > 0) {
                const percentage = (currentTime / duration) * 100;
                progressFill.style.width = percentage + '%';
            }
            
            if (progressTime) {
                const current = formatTime(currentTime);
                const total = formatTime(duration);
                progressTime.textContent = `${current} / ${total}`;
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function startProgressUpdate() {
            clearProgressUpdate();
            progressUpdateInterval = setInterval(() => {
                if (currentAudio && !currentAudio.paused) {
                    updateProgressBar(currentAudio.currentTime, currentAudio.duration);
                }
            }, 100);
        }

        function clearProgressUpdate() {
            if (progressUpdateInterval) {
                clearInterval(progressUpdateInterval);
                progressUpdateInterval = null;
            }
        }

        function seekAudio(event) {
            if (!currentAudio) return;
            
            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            const newTime = percentage * currentAudio.duration;
            
            currentAudio.currentTime = newTime;
            updateProgressBar(newTime, currentAudio.duration);
            
            logToConsole(`‚èØÔ∏è SEEK: ${formatTime(newTime)}`, 'info');
        }

        // A/B Comparison functionality
        async function startComparison(type) {
            try {
                if (!audioElements.source || !audioElements.mastered) {
                    logToConsole('‚ùå Need both source and mastered audio for comparison', 'error');
                    return;
                }

                comparisonMode = true;
                comparisonAudio.a = audioElements.source;
                comparisonAudio.b = audioElements.mastered;

                // Stop any current playback
                stopAudio();
                stopComparison();

                // Set up gain nodes for crossfading
                if (audioContext) {
                    setupComparisonGains();
                }

                // Start with specified type
                if (type === 'source') {
                    await playComparisonAudio('a');
                    updateABButtons('source');
                } else {
                    await playComparisonAudio('b');
                    updateABButtons('mastered');
                }

                logToConsole(`üîÑ A/B Comparison started: ${type}`, 'success');
            } catch (error) {
                logToConsole(`‚ùå Comparison error: ${error.message}`, 'error');
            }
        }

        let gainNodeA = null;
        let gainNodeB = null;

        function setupComparisonGains() {
            if (!audioContext) return;

            try {
                gainNodeA = audioContext.createGain();
                gainNodeB = audioContext.createGain();
                
                gainNodeA.connect(audioContext.destination);
                gainNodeB.connect(audioContext.destination);
                
                // Initialize crossfade
                updateCrossfade(crossfadeValue);
            } catch (error) {
                logToConsole(`‚ùå Gain setup error: ${error.message}`, 'error');
            }
        }

        async function playComparisonAudio(which) {
            const audio = which === 'a' ? comparisonAudio.a : comparisonAudio.b;
            if (!audio) return;

            currentAudio = audio;
            await audio.play();
            startProgressUpdate();
            drawWaveform();
        }

        function updateCrossfade(value) {
            crossfadeValue = value;
            
            if (gainNodeA && gainNodeB) {
                const gainA = Math.cos((value / 100) * Math.PI / 2);
                const gainB = Math.sin((value / 100) * Math.PI / 2);
                
                gainNodeA.gain.value = gainA;
                gainNodeB.gain.value = gainB;
            }

            // Update visual feedback
            const crossfadeSlider = document.getElementById('crossfade');
            if (crossfadeSlider) {
                crossfadeSlider.value = value;
            }

            // If in real-time comparison mode, adjust volumes
            if (comparisonMode && comparisonAudio.a && comparisonAudio.b) {
                const volumeA = (100 - value) / 100;
                const volumeB = value / 100;
                
                comparisonAudio.a.volume = volumeA;
                comparisonAudio.b.volume = volumeB;
            }

            logToConsole(`üéöÔ∏è Crossfade: ${Math.round(100-value)}% A / ${Math.round(value)}% B`, 'info');
        }

        async function toggleComparison() {
            if (!comparisonMode) {
                logToConsole('‚ùå Start A/B comparison first', 'error');
                return;
            }

            const isPlayingA = currentAudio === comparisonAudio.a;
            const currentTime = currentAudio ? currentAudio.currentTime : 0;
            
            // Stop current
            if (currentAudio) {
                currentAudio.pause();
            }

            // Switch to other audio
            const nextAudio = isPlayingA ? comparisonAudio.b : comparisonAudio.a;
            const nextType = isPlayingA ? 'mastered' : 'source';
            
            if (nextAudio) {
                nextAudio.currentTime = currentTime; // Sync position
                await nextAudio.play();
                currentAudio = nextAudio;
                updateABButtons(nextType);
                logToConsole(`üîÑ Switched to: ${nextType}`, 'click');
            }
        }

        async function syncPlayback() {
            if (!comparisonMode || !comparisonAudio.a || !comparisonAudio.b) return;

            const currentTime = currentAudio ? currentAudio.currentTime : 0;
            
            // Sync both audio positions
            comparisonAudio.a.currentTime = currentTime;
            comparisonAudio.b.currentTime = currentTime;
            
            // Start simultaneous playback for real-time mixing
            try {
                await Promise.all([
                    comparisonAudio.a.play(),
                    comparisonAudio.b.play()
                ]);
                
                // Use crossfade to control mix
                updateCrossfade(crossfadeValue);
                
                logToConsole('üîó Synchronized playback started - use crossfade slider', 'success');
            } catch (error) {
                logToConsole(`‚ùå Sync error: ${error.message}`, 'error');
            }
        }

        function stopComparison() {
            comparisonMode = false;
            
            if (comparisonAudio.a) {
                comparisonAudio.a.pause();
                comparisonAudio.a.currentTime = 0;
            }
            if (comparisonAudio.b) {
                comparisonAudio.b.pause();
                comparisonAudio.b.currentTime = 0;
            }
            
            currentAudio = null;
            clearProgressUpdate();
            updateProgressBar(0, 0);
            updateABButtons(null);
            
            logToConsole('‚èπÔ∏è A/B Comparison stopped', 'info');
        }

        function updateABButtons(activeType) {
            const sourceBtn = document.getElementById('ab-source');
            const masteredBtn = document.getElementById('ab-mastered');
            
            if (sourceBtn && masteredBtn) {
                sourceBtn.classList.remove('active');
                masteredBtn.classList.remove('active');
                
                if (activeType === 'source') {
                    sourceBtn.classList.add('active');
                } else if (activeType === 'mastered') {
                    masteredBtn.classList.add('active');
                }
            }
        }

        function downloadAudio() {
            logToConsole('üíæ DOWNLOAD: Preparing mastered audio download...', 'click');
            
            if (audioElements.mastered) {
                try {
                    const a = document.createElement('a');
                    a.href = audioElements.mastered.src;
                    a.download = 'studio-buddy-mastered.mp3';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    logToConsole('‚úÖ DOWNLOAD: Mastered audio downloaded', 'success');
                } catch (error) {
                    logToConsole(`‚ùå DOWNLOAD ERROR: ${error.message}`, 'error');
                }
            } else {
                logToConsole('‚ùå No mastered audio available. Run mastering first.', 'error');
            }
        }

        // Settings
        function logSetting(setting, value) {
            logToConsole(`‚öôÔ∏è SETTING: ${setting} = ${value}`, 'info');
        }

        // Audio visualization with Web Audio API
        let analyser = null;
        let animationId = null;

        function setupAudioVisualization(audio) {
            if (!audioContext || !audio) return;
            
            try {
                const source = audioContext.createMediaElementSource(audio);
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                
                logToConsole('üéµ Audio visualization connected', 'success');
            } catch (error) {
                logToConsole(`‚ùå Visualization error: ${error.message}`, 'error');
            }
        }

        function drawWaveform() {
            const canvas = document.getElementById('waveform-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);
            
            if (analyser && currentAudio && !currentAudio.paused) {
                // Real-time audio visualization
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                analyser.getByteFrequencyData(dataArray);
                
                ctx.strokeStyle = '#00ff00';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const sliceWidth = width / bufferLength;
                let x = 0;
                
                for (let i = 0; i < bufferLength; i++) {
                    const v = dataArray[i] / 255.0;
                    const y = v * height;
                    
                    if (i === 0) {
                        ctx.moveTo(x, height - y);
                    } else {
                        ctx.lineTo(x, height - y);
                    }
                    
                    x += sliceWidth;
                }
                
                ctx.stroke();
                
                // Continue animation
                animationId = requestAnimationFrame(drawWaveform);
            } else {
                // Static waveform when no audio playing
                ctx.strokeStyle = '#00ff00';
                ctx.lineWidth = 1;
                ctx.beginPath();
                
                for (let i = 0; i < width; i++) {
                    const amplitude = Math.sin(i * 0.02) * height * 0.2;
                    const y = height / 2 + amplitude;
                    
                    if (i === 0) {
                        ctx.moveTo(i, y);
                    } else {
                        ctx.lineTo(i, y);
                    }
                }
                
                ctx.stroke();
            }
        }

        function drawSpectrum() {
            const canvas = document.getElementById('spectrum-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);
            
            // Draw spectrum bars
            const barWidth = width / 64;
            ctx.fillStyle = '#00ff00';
            
            for (let i = 0; i < 64; i++) {
                const barHeight = Math.random() * height * 0.8;
                ctx.fillRect(i * barWidth, height - barHeight, barWidth - 1, barHeight);
            }
            
            logToConsole('üìä VISUALIZATION: Frequency spectrum rendered', 'info');
        }

        // Initialize application
        window.addEventListener('load', () => {
            logToConsole('üöÄ SYSTEM: Studio Buddy Web initialized', 'success');
            logToConsole('üìç URL: ' + window.location.href, 'info');
            logToConsole('üåê User Agent: ' + navigator.userAgent.substring(0, 50) + '...', 'info');
            
            // Start Matrix background animation
            createMatrixRain();
            logToConsole('üîã Matrix digital rain activated', 'success');
            
            // Start clock
            updateClock();
            setInterval(updateClock, 1000);
            logToConsole('üïê System clock synchronized', 'success');
            
            // Enable audio context on first user interaction
            document.addEventListener('click', async () => {
                if (audioContext && audioContext.state === 'suspended') {
                    await audioContext.resume();
                    logToConsole('üîä Audio context resumed', 'success');
                }
            }, { once: true });
            
            logToConsole('üéØ Ready for interaction - hover and click icons!', 'info');
            logToConsole('üéµ Load audio files and click play buttons to hear audio', 'info');
            
            isInitialized = true;
        });

        // Error handling
        window.addEventListener('error', (event) => {
            logToConsole(`‚ùå ERROR: ${event.message}`, 'error');
        });

        logToConsole('üìÑ SCRIPT: Main script loaded successfully', 'success');
    </script>
</body>
</html>