<!DOCTYPE html>
<html>
<head>
    <title>Railway API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #000; color: #0f0; }
        .log { margin: 5px 0; padding: 5px; background: #111; }
        .error { color: #f00; }
        .success { color: #0f0; }
        .info { color: #ff0; }
        button { padding: 10px; margin: 10px; }
        input { margin: 10px; }
    </style>
</head>
<body>
    <h1>üß™ Railway API Debug Test</h1>
    
    <div>
        <h3>Test Audio File:</h3>
        <input type="file" id="testFile" accept="audio/*">
        <button onclick="testMasterAPI()">Test Master API</button>
        <button onclick="testAnalyzeAPI()">Test Analyze API</button>
        <button onclick="testDirectAPI()">Test Direct Railway</button>
    </div>
    
    <div id="log"></div>
    
    <script>
        function log(msg, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="log ${type}">[${time}] ${msg}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        }
        
        async function testMasterAPI() {
            const file = document.getElementById('testFile').files[0];
            if (!file) {
                log('‚ùå Please select a file first', 'error');
                return;
            }
            
            log(`üß™ Testing Master API with: ${file.name} (${file.type}, ${file.size} bytes)`);
            
            // Test different FormData configurations
            const tests = [
                { name: 'audio', key: 'audio' },
                { name: 'source', key: 'source' },
                { name: 'file', key: 'file' },
                { name: 'input_audio', key: 'input_audio' },
                { name: 'track', key: 'track' }
            ];
            
            for (const test of tests) {
                try {
                    log(`üì§ Testing with parameter: ${test.key}`);
                    
                    const formData = new FormData();
                    formData.append(test.key, file);
                    
                    const response = await fetch('/api/master', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const responseText = await response.text();
                    
                    if (response.ok) {
                        log(`‚úÖ SUCCESS with ${test.key}: ${response.status}`, 'success');
                        break;
                    } else {
                        log(`‚ùå ${test.key} failed: ${response.status} - ${responseText}`, 'error');
                    }
                } catch (error) {
                    log(`üí• ${test.key} error: ${error.message}`, 'error');
                }
            }
        }
        
        async function testAnalyzeAPI() {
            const file = document.getElementById('testFile').files[0];
            if (!file) {
                log('‚ùå Please select a file first', 'error');
                return;
            }
            
            log(`üß™ Testing Analyze API with: ${file.name}`);
            
            const formData = new FormData();
            formData.append('audio', file);
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    body: formData
                });
                
                const responseText = await response.text();
                
                if (response.ok) {
                    log(`‚úÖ Analyze API SUCCESS: ${responseText}`, 'success');
                } else {
                    log(`‚ùå Analyze API failed: ${response.status} - ${responseText}`, 'error');
                }
            } catch (error) {
                log(`üí• Analyze API error: ${error.message}`, 'error');
            }
        }
        
        async function testDirectAPI() {
            const file = document.getElementById('testFile').files[0];
            if (!file) {
                log('‚ùå Please select a file first', 'error');
                return;
            }
            
            log(`üß™ Testing DIRECT Railway API (will likely CORS error)`);
            
            const formData = new FormData();
            formData.append('audio', file);
            
            try {
                const response = await fetch('https://studiobuddy-production.up.railway.app/master', {
                    method: 'POST',
                    body: formData
                });
                
                const responseText = await response.text();
                log(`üéØ Direct API response: ${response.status} - ${responseText}`, 'info');
            } catch (error) {
                log(`üö´ Direct API error (expected CORS): ${error.message}`, 'info');
            }
        }
        
        log('üöÄ API Test Tool Ready', 'success');
    </script>
</body>
</html>